<div id="infoPopupConfigPage" data-role="page" class="page libraryPage">
<div class="padded-left padded-right padded-bottom-page">

    <!-- En-tête -->
    <div class="detailSection">
        <h2 class="sectionTitle">
            <span class="material-icons" style="vertical-align:middle;margin-right:8px;">notifications_active</span>
            Info Popup
        </h2>
        <p id="ip-subtitle" class="sectionText" style="opacity:.75;margin-top:4px;">
            Diffusez des messages à tous les utilisateurs. Le message s'affiche en popup à leur prochaine connexion.
        </p>
    </div>

    <!-- Nouveau message -->
    <div class="detailSection">
        <h3 class="sectionTitle" id="ip-form-section-title">Nouveau message</h3>

        <div class="inputContainer">
            <label id="ip-title-label" class="inputLabel inputLabelUnfocused" for="ip-title">Titre *</label>
            <input id="ip-title"
                   type="text"
                   class="emby-input"
                   maxlength="200"
                   placeholder="Saisir le titre du message..."
                   autocomplete="off"/>
            <div id="ip-title-err" class="fieldDescription" style="color:#cf6679;display:none;"></div>
        </div>

        <div class="inputContainer" style="margin-top:16px;">
            <!-- inputLabelUnfocused est intentionnellement absent :
                 en 0.7 le textarea est toujours visible, ce qui active le mécanisme
                 floating-label de Jellyfin (position:absolute + animation). Le label
                 "vole" alors au focus/blur et entre en conflit avec la toolbar.
                 inputLabel seul donne le style (couleur, taille) sans animer. -->
            <label id="ip-body-label" class="inputLabel" for="ip-body"
                   style="display:block;margin-bottom:8px;">Message *</label>

            <!-- Toolbar de formatage + toggle apercu -->
            <div id="ip-format-toolbar" style="display:flex;gap:4px;margin-bottom:6px;flex-wrap:wrap;align-items:center;">
                <button type="button" class="ip-fmt-btn" data-action="bold"      title="Gras"><strong>B</strong></button>
                <button type="button" class="ip-fmt-btn" data-action="italic"    title="Italique"><em>I</em></button>
                <button type="button" class="ip-fmt-btn" data-action="underline" title="Souligne"><u>U</u></button>
                <button type="button" class="ip-fmt-btn" data-action="strike"    title="Barre"><s>S</s></button>
                <button type="button" class="ip-fmt-btn ip-fmt-btn-sep" data-action="list" title="Liste a puces">&#8226; Liste</button>
                <label class="ip-preview-toggle-wrap" for="ip-preview-toggle"
                       title="Afficher l'apercu formate du message">
                    <div class="ip-toggle-switch">
                        <input type="checkbox" id="ip-preview-toggle">
                        <span class="ip-toggle-slider"></span>
                    </div>
                    <span id="ip-preview-toggle-label">Raw</span>
                </label>
            </div>

            <!-- Zone de saisie (toujours visible) + panneau apercu optionnel en dessous -->
            <div class="ip-editor-wrap">
                <textarea id="ip-body"
                          class="emby-textarea"
                          maxlength="10000"
                          rows="7"
                          placeholder="Saisir le contenu... (**gras**, _italique_, ~~barre~~, __souligne__, - liste)"
                          style="width:100%;box-sizing:border-box;resize:vertical;display:none;"></textarea>
                <div id="ip-body-preview" class="ip-body-preview" style="margin-top:8px;">
                    <span class="ip-preview-hint">Cliquez ici ou sur &laquo;&nbsp;Raw&nbsp;&raquo; pour commencer &agrave; saisir&hellip;</span>
                </div>
            </div>

            <div id="ip-body-err" class="fieldDescription" style="color:#cf6679;display:none;"></div>
        </div>

        <div class="inputContainer" style="margin-top:16px;">
            <label id="ip-recipients-label" class="inputLabel inputLabelUnfocused">Destinataires</label>
            <div id="ip-target-picker" style="margin-top:8px;">
                <span style="opacity:.5;font-size:.88rem;">Chargement des utilisateurs...</span>
            </div>
        </div>

        <div style="margin-top:20px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <button id="ip-publish-btn" class="raised button-submit emby-button" type="button">
                Publier le message
            </button>
            <button id="ip-cancel-edit-btn" class="raised emby-button" type="button"
                    style="display:none;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);">
                Annuler la modification
            </button>
            <div id="ip-toast" style="display:none;padding:8px 14px;border-radius:4px;font-size:.9rem;"></div>
        </div>
    </div>

    <!-- Historique des messages -->
    <div class="detailSection" style="margin-top:32px;">
        <h3 id="ip-history-title" class="sectionTitle">Historique des messages</h3>

        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;">
                <input id="ip-select-all" type="checkbox"
                       style="width:16px;height:16px;cursor:pointer;accent-color:var(--theme-accent-color,#00a4dc);flex-shrink:0;"/>
                <span id="ip-select-all-label">Tout selectionner</span>
            </label>
            <button id="ip-delete-btn" class="raised emby-button button-delete" type="button" disabled
                    style="display:flex;align-items:center;gap:6px;">
                <span class="material-icons" style="font-size:1em;">delete</span>
                <span id="ip-delete-btn-label">Supprimer la selection</span>
            </button>
            <span id="ip-sel-count" style="opacity:.6;font-size:.88rem;"></span>
        </div>

        <div id="ip-msg-container">
            <p id="ip-empty" style="opacity:.55;">Aucun message publie pour le moment.</p>
        </div>
    </div>

</div>
</div>

<script src="/InfoPopup/client.js"></script>
