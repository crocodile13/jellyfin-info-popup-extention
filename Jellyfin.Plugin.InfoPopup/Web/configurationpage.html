<div id="infoPopupConfigPage" data-role="page" class="page libraryPage">
<div class="padded-left padded-right padded-bottom-page">

    <!-- En-tête -->
    <div class="detailSection">
        <h2 class="sectionTitle">
            <span class="material-icons" style="vertical-align:middle;margin-right:8px;">notifications_active</span>
            Info Popup
        </h2>
        <p class="sectionText" style="opacity:.75;margin-top:4px;">
            Diffusez des messages à tous les utilisateurs. Le message s'affiche en popup à leur prochaine connexion.
        </p>
    </div>

    <!-- Nouveau message -->
    <div class="detailSection">
        <h3 class="sectionTitle">Nouveau message</h3>

        <div class="inputContainer">
            <label class="inputLabel inputLabelUnfocused" for="ip-title">Titre *</label>
            <input id="ip-title"
                   type="text"
                   class="emby-input"
                   maxlength="200"
                   placeholder="Saisir le titre du message..."
                   autocomplete="off"/>
            <div id="ip-title-err" class="fieldDescription" style="color:#cf6679;display:none;"></div>
        </div>

        <div class="inputContainer" style="margin-top:16px;">
            <label class="inputLabel inputLabelUnfocused" for="ip-body">Message *</label>
            <textarea id="ip-body"
                      class="emby-textarea"
                      maxlength="10000"
                      rows="6"
                      placeholder="Saisir le contenu en texte brut..."
                      style="resize:vertical;width:100%;box-sizing:border-box;"></textarea>
            <div id="ip-body-err" class="fieldDescription" style="color:#cf6679;display:none;"></div>
        </div>

        <div class="inputContainer" style="margin-top:16px;">
            <label class="inputLabel inputLabelUnfocused">Destinataires</label>
            <div id="ip-target-picker" style="margin-top:8px;">
                <span style="opacity:.5;font-size:.88rem;">Chargement des utilisateurs...</span>
            </div>
        </div>

        <div style="margin-top:20px;display:flex;align-items:center;gap:16px;flex-wrap:wrap;">
            <button id="ip-publish-btn" class="raised button-submit emby-button" type="button">
                <span class="material-icons" style="vertical-align:middle;margin-right:6px;font-size:1.1em;">send</span>
                Publier le message
            </button>
            <div id="ip-toast" style="display:none;padding:8px 14px;border-radius:4px;font-size:.9rem;"></div>
        </div>
    </div>

    <!-- Historique -->
    <div class="detailSection" style="margin-top:32px;">
        <h3 class="sectionTitle">Historique des messages</h3>

        <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
            <label style="display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;">
                <input id="ip-select-all" type="checkbox" class="emby-checkbox"/>
                <span>Tout sélectionner</span>
            </label>
            <button id="ip-delete-btn" class="raised emby-button button-delete" type="button" disabled
                    style="display:flex;align-items:center;gap:6px;">
                <span class="material-icons" style="font-size:1em;">delete</span>
                Supprimer la sélection
            </button>
            <span id="ip-sel-count" style="opacity:.6;font-size:.88rem;"></span>
        </div>

        <div id="ip-msg-container">
            <p id="ip-empty" style="opacity:.55;">Aucun message publié pour le moment.</p>
        </div>
    </div>

</div>
</div>

<style>
.ip-table { width:100%; border-collapse:collapse; font-size:.92rem; }
.ip-table thead th { text-align:left; padding:10px 12px; border-bottom:2px solid rgba(255,255,255,.15); font-weight:600; opacity:.8; }
.ip-table tbody tr { border-bottom:1px solid rgba(255,255,255,.07); transition:background .12s; }
.ip-table tbody tr:hover { background:rgba(255,255,255,.04); }
.ip-table td { padding:10px 12px; vertical-align:middle; }
.ip-col-check  { width:40px; }
.ip-col-date   { width:160px; opacity:.65; white-space:nowrap; }
.ip-col-target { width:150px; }
.ip-col-title  { font-weight:500; overflow-wrap:break-word; word-break:break-word; }

.ip-badge { display:inline-block; padding:2px 9px; border-radius:10px; font-size:.78rem; font-weight:500; white-space:nowrap; }
.ip-badge-all     { background:rgba(255,255,255,.1); color:rgba(255,255,255,.7); }
.ip-badge-partial { background:rgba(0,164,220,.18); border:1px solid rgba(0,164,220,.35); color:var(--theme-accent-color,#00a4dc); }

.ip-toast-ok  { background:rgba(0,180,100,.2); border:1px solid rgba(0,180,100,.5); color:#6ee09f; }
.ip-toast-err { background:rgba(207,102,121,.2); border:1px solid rgba(207,102,121,.5); color:#cf6679; }

.ip-target-box { border:1px solid rgba(255,255,255,.12); border-radius:6px; overflow:hidden; }
.ip-target-all-row { display:flex; align-items:center; gap:10px; padding:10px 14px; background:rgba(255,255,255,.03); }
.ip-target-all-row label { display:flex; align-items:center; gap:8px; cursor:pointer; font-size:.93rem; user-select:none; }
.ip-target-user-list { border-top:1px solid rgba(255,255,255,.1); max-height:200px; overflow-y:auto; padding:8px 0; }
.ip-target-user-list label { display:flex; align-items:center; gap:8px; padding:5px 14px; cursor:pointer; font-size:.88rem; transition:background .1s; user-select:none; }
.ip-target-user-list label:hover { background:rgba(255,255,255,.04); }
</style>

<!-- Fallback : charge client.js si Jellyfin ne l'a pas encore injecté via le plugin manager -->
<script src="/InfoPopup/client.js"></script>
