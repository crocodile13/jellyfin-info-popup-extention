[
  {
    "guid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "name": "Info Popup",
    "description": "Permet aux administrateurs de diffuser des messages popup aux utilisateurs lors de leur connexion.",
    "overview": "Messages popup pour les utilisateurs Jellyfin",
    "owner": "crocodile13",
    "category": "General",
    "imageUrl": "https://raw.githubusercontent.com/crocodile13/jellyfin-info-popup-extention/main/assets/icon.png",
    "versions": [
      {
        "version": "0.6.2.0",
        "changelog": "\\### Added\\\\- **Multilanguage support (FR / EN)** ‚Äî the plugin now detects the active Jellyfin language via `document.documentElement.lang` (set by Jellyfin Web according to user preferences) with a fallback to `navigator.language`. French and English are fully supported. All user-facing strings ‚Äî admin page labels, toasts, validation errors, confirm dialog, toolbar tooltips, user popup, history accordion ‚Äî are translated. Adding a new language requires only a new dictionary entry in `ip-i18n.js`.\\- **`ip-i18n.js` module** ‚Äî language detection (`detectLang()`) + `window.__IP.t(key, ...args)` translation function with `{0}`, `{1}` placeholder substitution.\\\\### Changed\\\\- **`client.js` split into 5 focused modules** ‚Äî the 1 217-line monolith is replaced by a lightweight loader (`client.js`, ~50 lines) that injects modules sequentially via dynamic `<script>` tags:\\  - `ip-i18n.js` ‚Äî language detection + FR/EN dictionaries\\  - `ip-utils.js` ‚Äî shared utilities (`apiFetch`, `escHtml`, `renderBody`, `formatDate`)\\  - `ip-styles.js` ‚Äî idempotent CSS injection (`injectStyles`)\\  - `ip-admin.js` ‚Äî admin configuration page (form, table, toolbar, targeting, CRUD)\\  - `ip-popup.js` ‚Äî user popup + MutationObserver (auto-starts)\\- **`window.__IP` namespace** ‚Äî all inter-module functions are exposed via `window.__IP` instead of closed-over variables. Each module is an IIFE that reads and extends `window.__IP`.\\- **Controller ‚Äî generic JS module endpoint** ‚Äî `GET /InfoPopup/client.js` is replaced by `GET /InfoPopup/{module}.js` with a whitelist (`client.js`, `ip-*.js`). The old dedicated action is removed; a single action now serves all modules.\\- **`configurationpage.html`** ‚Äî static text remains in French as default (overridden by `applyStaticTranslations()` at runtime). Added `id` attributes to all translatable elements (`#ip-subtitle`, `#ip-title-label`, `#ip-body-label`, `#ip-recipients-label`, `#ip-history-title`, `#ip-select-all-label`, `#ip-delete-btn-label`). The `<span>` inside `#ip-delete-btn` is now a separate element to allow text-only translation without touching the icon.\\- **`Jellyfin.Plugin.InfoPopup.csproj`** ‚Äî `ip-i18n.js`, `ip-utils.js`, `ip-styles.js`, `ip-admin.js`, `ip-popup.js` added as `<EmbeddedResource>`.\\- **`CLAUDE.md`** ‚Äî architecture, naming, pitfalls and REST API reference updated for v0.6.\\\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.6.2.0/infopopup_0.6.2.0.zip",
        "checksum": "cdb054c8aee87d1cfc22e8df58af033f",
        "timestamp": "2026-02-23T16:36:16Z"
      },
      {
        "version": "0.5.0.0",
        "changelog": "\\### S√©curit√©\\\\- **Contr√¥le d'acc√®s sur `GET /messages` et `GET /messages/{id}`** ‚Äî ces endpoints √©taient accessibles √† tout utilisateur authentifi√©, exposant la liste compl√®te des messages y compris leurs `TargetUserIds` et leurs corps, ind√©pendamment du ciblage. D√©sormais : les admins voient tout ; les utilisateurs ne voient que les messages qui leur sont destin√©s. `GET /messages/{id}` retourne `404` (et non `403`) si l'utilisateur n'est pas cibl√©, pour ne pas r√©v√©ler l'existence d'un message non destin√©.\\- **UserId vide ‚Üí 401 explicite** ‚Äî quand le claim `Jellyfin-UserId` est absent du token, le code retournait silencieusement un ID vide qui cr√©ait un enregistrement fant√¥me dans `infopopup_seen.json`. Tous les endpoints utilisateur retournent maintenant `401 Unauthorized` explicitement si l'ID est absent.\\\\### Ajout√©\\\\- **Endpoint `GET /InfoPopup/popup-data`** ‚Äî retourne en un seul appel tout ce dont la popup a besoin : messages non vus avec corps complet + historique en r√©sum√©s. Remplace l'ancien pattern N+1 qui g√©n√©rait jusqu'√† `2 + N + M` requ√™tes HTTP pour afficher une popup.\\- **Endpoint `POST /InfoPopup/messages/delete`** (admin) ‚Äî remplace `DELETE /messages` avec body. Certains proxies et pare-feux rejettent silencieusement les requ√™tes `DELETE` avec un body. L'ancien endpoint `DELETE` est supprim√©.\\- **Dossier `DTOs/`** ‚Äî `MessageDtos.cs` regroupe tous les DTOs (`CreateMessageRequest`, `DeleteMessagesRequest`, `UpdateMessageRequest`, `MarkSeenRequest`, `MessageSummary`, `MessageDetail`, `PopupDataResponse`). Ils √©taient pr√©c√©demment d√©finis en t√™te du fichier controller.\\\\### Corrig√©\\\\- **Race condition popup/marquage** ‚Äî `popupActive` √©tait remis √† `false` imm√©diatement √† la fermeture de la popup, avant que le `POST /seen` ait √©t√© confirm√© par le serveur. `popupActive` reste maintenant √† `true` jusqu'au `.finally()` de `markAllSeen()`.\\- **Guard `popupActive` dans `schedulePopupCheck`** ‚Äî sans ce guard, une navigation rapide apr√®s fermeture pouvait re-d√©clencher un check r√©seau pendant que le marquage √©tait encore en transit.\\- **R√©f√©rence config captur√©e dans le lock** (`MessageStore`) ‚Äî `Plugin.Instance?.Configuration` √©tait acc√©d√© via une propri√©t√© sans assignation locale dans le bloc lockt√©. La r√©f√©rence est maintenant captur√©e avec `var cfg = GetConfig()` √† l'int√©rieur de chaque bloc.\\- **Cache m√©moire dans `SeenTrackerService`** ‚Äî `ReadStore()` lisait le fichier JSON depuis le disque √† chaque appel, y compris sous `ReadLock`. Un cache `_cache` est maintenant maintenu en m√©moire et invalid√© uniquement √† l'√©criture.\\- **Accessibilit√© du toast admin** ‚Äî `aria-live=\"polite\"` et `role=\"status\"` ajout√©s sur le toast lors de l'init de la page config et √† chaque affichage.\\\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.5.0.0/infopopup_0.5.0.0.zip",
        "checksum": "d51cd6f62b561d183081a972cfd1cc7f",
        "timestamp": "2026-02-23T13:11:19Z"
      },
      {
        "version": "0.4.0.0",
        "changelog": "\\### Ajout√©\\\\- **Formatage du corps des messages** ‚Äî syntaxe l√©g√®re rendue c√¥t√© client en HTML s√©curis√© (escHtml() toujours appliqu√© avant tout remplacement, XSS impossible) :\\  - `**texte**` ‚Üí gras\\  - `_texte_` ‚Üí italique\\  - `__texte__` ‚Üí soulign√©\\  - `~~texte~~` ‚Üí barr√©\\  - Lignes pr√©fix√©es `- ` ‚Üí liste √† puces avec indentation (`<ul><li>`)\\  - Rendu actif dans la popup utilisateur, dans l'historique et dans le d√©roulant du tableau admin.\\- **Toolbar de formatage** au-dessus du textarea d'administration ‚Äî cinq boutons (B, I, U, S, ‚Ä¢ Liste) qui wrappent la s√©lection courante. Chaque bouton est un toggle : appuyer une seconde fois retire le formatage.\\- **Modification de messages existants** ‚Äî bouton ¬´ ‚úé Modifier ¬ª sur chaque ligne du tableau admin. Charge le message dans le formulaire, passe en mode √©dition (titre de section + libell√© du bouton changent, bouton ¬´ Annuler ¬ª appara√Æt). Utilise `PUT /InfoPopup/messages/{id}` : l'ID est conserv√©, le suivi des vues n'est pas affect√© ‚Äî un utilisateur ayant d√©j√† vu le message ne le reverra pas.\\- **Endpoint `PUT /InfoPopup/messages/{id}`** (admin uniquement) ‚Äî met √† jour titre et corps sans toucher √† l'ID ni √† `infopopup_seen.json`.\\\\### Corrig√©\\\\- **Corps vide dans l'historique de la popup** ‚Äî les messages d√©j√† vus pass√©s √† `buildHistoryBlock` √©taient des `MessageSummary` sans `body`. `checkForUnseenMessages` pr√©-charge d√©sormais le d√©tail complet de chaque message vu (via `Promise.all` en parall√®le) avant d'ouvrir la popup.\\- **Mise en forme cass√©e du tableau admin** ‚Äî CSS de `.ip-row-expand`, `.ip-row-chev`, `.ip-edit-btn` absent lors d'une navigation directe vers la page config (car `injectStyles()` n'√©tait appel√© que par `showPopup`). `initConfigPage()` appelle maintenant `injectStyles()` en premier.\\\\### Modifi√©\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.4.0.0/infopopup_0.4.0.0.zip",
        "checksum": "6bcbc8222286dbe162b3b994adb6e91d",
        "timestamp": "2026-02-23T10:19:23Z"
      },
      {
        "version": "0.3.0.0",
        "changelog": "\\### Ajout√©\\\\- **Affichage de tous les messages non vus en zone principale** ‚Äî si un utilisateur a plusieurs messages non lus au moment de la connexion, chacun s'affiche d√©sormais dans sa propre carte titr√©e (avec titre en gras + corps), sans √™tre rel√©gu√© dans l'historique d√©roulant. L'historique ne contient plus que les messages d√©j√† vus.\\- **Titre du message affich√© dans l'en-t√™te de la popup** ‚Äî lorsqu'un seul message est non vu, son titre appara√Æt directement dans la barre d'en-t√™te de la popup (√† c√¥t√© de l'ic√¥ne üîî). Lorsque plusieurs messages sont non vus, l'en-t√™te affiche ¬´ N nouveaux messages ¬ª.\\- **D√©roulant par ligne dans le tableau d'administration** ‚Äî la colonne Titre de chaque message dans la page de config est d√©sormais cliquable : un clic ins√®re une ligne d'expansion en dessous affichant le corps du message, charg√© √† la demande (lazy-load). Un chevron anim√© (‚ñ∂ ‚Üí ‚Üì) indique l'√©tat ouvert/ferm√©.\\\\### Modifi√©\\\\- `checkForUnseenMessages` r√©cup√®re maintenant le corps complet de tous les messages non vus en parall√®le (`Promise.all`) avant d'ouvrir la popup, au lieu de ne charger que le plus r√©cent.\\- `showPopup` accepte d√©sormais deux arguments (`unseenMessages`, `seenMessages`) au lieu de trois, et adapte son rendu dynamiquement selon le nombre de messages non vus.\\- `renderMessages` g√©n√®re une ligne d'expansion `<tr>` pour chaque message du tableau admin, avec chargement lazy du corps via l'API.\\\\---\\\\## [0.2.1.0] ‚Äî 2026-02-20\\\\*(version initiale publi√©e)*\\\\### Ajout√©\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.3.0.0/infopopup_0.3.0.0.zip",
        "checksum": "482cf8d10ca73ca4ebe1e3b0f5228f52",
        "timestamp": "2026-02-23T09:52:46Z"
      },
      {
        "version": "0.2.1.0",
        "changelog": "Release v0.2.1.0",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.2.1.0/infopopup_0.2.1.0.zip",
        "checksum": "ebf0f52f77c603f22ac26fdbccc3a62a",
        "timestamp": "2026-02-22T17:40:58Z"
      },
      {
        "version": "0.2.0.0",
        "changelog": "Release v0.2.0.0",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.2.0.0/infopopup_0.2.0.0.zip",
        "checksum": "8a5d02748a4ee36d1583a9ed093db2f0",
        "timestamp": "2026-02-21T18:08:04Z"
      }
    ]
  }
]
