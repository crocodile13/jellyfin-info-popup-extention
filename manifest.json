[
  {
    "guid": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "name": "Info Popup",
    "description": "Permet aux administrateurs de diffuser des messages popup aux utilisateurs lors de leur connexion.",
    "overview": "Messages popup pour les utilisateurs Jellyfin",
    "owner": "crocodile13",
    "category": "General",
    "imageUrl": "https://raw.githubusercontent.com/crocodile13/jellyfin-info-popup-extention/main/assets/icon.png",
    "versions": [
      {
        "version": "0.8.0.0",
        "changelog": "\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.8.0.0/infopopup_0.8.0.0.zip",
        "checksum": "4d4b9fea40c1732090997587b5a4338a",
        "timestamp": "2026-02-23T20:00:06Z"
      },
      {
        "version": "0.7.1.0",
        "changelog": "\\### Fixed\\\\- **Label \"Message *\" flottant par-dessus la toolbar** â€” la classe Jellyfin `inputLabelUnfocused` applique `position:absolute` pour simuler le comportement Material Design (label qui flotte vers le haut au focus). En v0.7.0.0, le textarea Ã©tant dÃ©sormais toujours visible, Jellyfin le considÃ©rait comme focusable et repositionnait le label en position \"unfocused\", le faisant se superposer Ã  la toolbar de formatage (boutons B / I / U / S / Liste). CorrigÃ© en remplaÃ§ant `inputLabelUnfocused` par `position:static;display:block` sur `#ip-body-label` uniquement. Les labels Titre et Destinataires conservent leur comportement floating-label natif, car ils n'ont pas d'Ã©lÃ©ment intercalÃ© entre eux et leur champ de saisie.\\\\- **`document.addEventListener('selectionchange', â€¦)` jamais retirÃ©** â€” ce listener global Ã©tait ajoutÃ© sur `document` Ã  chaque initialisation de la page de configuration (`initConfigPage`). Dans une SPA, `initConfigPage` pouvant Ãªtre rappelÃ© Ã  chaque navigation, les listeners s'accumulaient sur la durÃ©e de la session. `selectionchange` pouvant se dÃ©clencher des dizaines de fois par seconde, l'overhead progressif pouvait Ãªtre perÃ§u comme un ralentissement gÃ©nÃ©ral. SupprimÃ© : `keyup`, `mouseup` et `touchend` sur le textarea couvrent tous les scÃ©narios utiles de mise Ã  jour de l'Ã©tat actif de la toolbar.\\\\- **Double dÃ©claration `var targetIds` dans `publishMessage()`** â€” `var targetIds` Ã©tait dÃ©clarÃ© deux fois dans le mÃªme scope de fonction (une fois dans la branche `if`, une fois dans la branche `else`). Fonctionnel grÃ¢ce au hoisting de `var`, mais signalÃ© comme erreur par les linters et potentiellement source de confusion. La dÃ©claration est remontÃ©e avant le `if/else`.\\\\---\\\\## [0.7.0.0] â€” 2026-02-23\\\\### Changed\\\\- **Ã‰diteur de message â€” textarea toujours visible** â€” le comportement prÃ©cÃ©dent affichait un panneau d'aperÃ§u formatÃ© par dÃ©faut et demandait de cliquer dessus (ou sur un bouton de la toolbar) pour basculer en mode Â« brut Â» (textarea). Ce changement de mode automatique est supprimÃ©. Le textarea est dÃ©sormais affichÃ© en permanence et directement accessible Ã  la frappe sans aucune interaction prÃ©alable. L'aperÃ§u formatÃ© devient un **panneau optionnel** situÃ© sous le textarea, activÃ© et dÃ©sactivÃ© par le toggle Â« AperÃ§u Â». Il se met Ã  jour en temps rÃ©el Ã  chaque frappe, uniquement lorsqu'il est visible.\\- **Toggle Â« Raw Â» renommÃ© Â« AperÃ§u Â»** â€” la sÃ©mantique est inversÃ©e : toggle cochÃ© = panneau d'aperÃ§u visible ; dÃ©cochÃ© = panneau cachÃ© (Ã©tat par dÃ©faut). La chaÃ®ne est mise Ã  jour dans les deux langues (`'AperÃ§u'` en FR, `'Preview'` en EN). Le tooltip passe de Â« Activer pour afficher le texte brut Â» Ã  Â« Afficher l'aperÃ§u formatÃ© du message Â».\\- **`PUT /InfoPopup/messages/{id}` accepte `TargetUserIds`** â€” le ciblage utilisateur peut dÃ©sormais Ãªtre modifiÃ© lors de l'Ã©dition d'un message existant. Avant cette version, seuls le titre et le corps pouvaient Ãªtre changÃ©s ; les destinataires restaient figÃ©s Ã  la valeur dÃ©finie Ã  la publication initiale. `UpdateMessageRequest` gagne le champ `List<string> TargetUserIds`. `MessageStore.Update()` accepte le nouveau paramÃ¨tre `List<string>? targetUserIds` et l'applique dans le lock.\\- **Mode Ã©dition â€” restauration du ciblage** â€” le formulaire d'Ã©dition (bouton Â« Modifier Â» dans le tableau) initialise maintenant le sÃ©lecteur de destinataires avec le ciblage actuel du message. La nouvelle fonction `setTargetPickerIds(page, ids)` dans `ip-admin.js` gÃ¨re ce cas : liste vide â†’ Â« Tous les utilisateurs Â» cochÃ© ; liste partielle â†’ case Â« Tous Â» dÃ©cochÃ©e, utilisateurs ciblÃ©s individuellement cochÃ©s.\\\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.7.1.0/infopopup_0.7.1.0.zip",
        "checksum": "2dae542079911c839bb10124c93bf36a",
        "timestamp": "2026-02-23T19:43:54Z"
      },
      {
        "version": "0.7.0.0",
        "changelog": "\\### Changed\\\\- **Ã‰diteur de message â€” textarea toujours visible** â€” le comportement prÃ©cÃ©dent affichait un panneau d'aperÃ§u formatÃ© par dÃ©faut et demandait de cliquer dessus (ou sur un bouton de la toolbar) pour basculer en mode Â« brut Â» (textarea). Ce changement de mode automatique est supprimÃ©. Le textarea est dÃ©sormais affichÃ© en permanence et directement accessible Ã  la frappe sans aucune interaction prÃ©alable. L'aperÃ§u formatÃ© devient un **panneau optionnel** situÃ© sous le textarea, activÃ© et dÃ©sactivÃ© par le toggle Â« AperÃ§u Â». Il se met Ã  jour en temps rÃ©el Ã  chaque frappe, uniquement lorsqu'il est visible.\\- **Toggle Â« Raw Â» renommÃ© Â« AperÃ§u Â»** â€” la sÃ©mantique est inversÃ©e : toggle cochÃ© = panneau d'aperÃ§u visible ; dÃ©cochÃ© = panneau cachÃ© (Ã©tat par dÃ©faut). La chaÃ®ne est mise Ã  jour dans les deux langues (`'AperÃ§u'` en FR, `'Preview'` en EN). Le tooltip passe de Â« Activer pour afficher le texte brut Â» Ã  Â« Afficher l'aperÃ§u formatÃ© du message Â».\\- **`PUT /InfoPopup/messages/{id}` accepte `TargetUserIds`** â€” le ciblage utilisateur peut dÃ©sormais Ãªtre modifiÃ© lors de l'Ã©dition d'un message existant. Avant cette version, seuls le titre et le corps pouvaient Ãªtre changÃ©s ; les destinataires restaient figÃ©s Ã  la valeur dÃ©finie Ã  la publication initiale. `UpdateMessageRequest` gagne le champ `List<string> TargetUserIds`. `MessageStore.Update()` accepte le nouveau paramÃ¨tre `List<string>? targetUserIds` et l'applique dans le lock.\\- **Mode Ã©dition â€” restauration du ciblage** â€” le formulaire d'Ã©dition (bouton Â« Modifier Â» dans le tableau) initialise maintenant le sÃ©lecteur de destinataires avec le ciblage actuel du message. La nouvelle fonction `setTargetPickerIds(page, ids)` dans `ip-admin.js` gÃ¨re ce cas : liste vide â†’ Â« Tous les utilisateurs Â» cochÃ© ; liste partielle â†’ case Â« Tous Â» dÃ©cochÃ©e, utilisateurs ciblÃ©s individuellement cochÃ©s.\\\\### Fixed\\\\- **Boutons de toolbar ne changent plus le mode d'affichage** â€” auparavant, cliquer sur B / I / U / S / Liste depuis le mode aperÃ§u forÃ§ait la bascule vers le textarea (mode brut). Ce comportement perturbant est supprimÃ©. Les boutons appliquent le formatage directement sur le textarea, qui est dÃ©sormais toujours visible.\\\\---\\\\## [0.6.2.0] â€” 2026-02-23\\\\### Added\\\\- **Multilanguage support (FR / EN)** â€” the plugin now detects the active Jellyfin language via `document.documentElement.lang` (set by Jellyfin Web according to user preferences) with a fallback to `navigator.language`. French and English are fully supported. All user-facing strings â€” admin page labels, toasts, validation errors, confirm dialog, toolbar tooltips, user popup, history accordion â€” are translated. Adding a new language requires only a new dictionary entry in `ip-i18n.js`.\\- **`ip-i18n.js` module** â€” language detection (`detectLang()`) + `window.__IP.t(key, ...args)` translation function with `{0}`, `{1}` placeholder substitution.\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.7.0.0/infopopup_0.7.0.0.zip",
        "checksum": "1dd22912203f15141bfbebf81613aa08",
        "timestamp": "2026-02-23T19:00:25Z"
      },
      {
        "version": "0.6.2.0",
        "changelog": "\\### Added\\\\- **Multilanguage support (FR / EN)** â€” the plugin now detects the active Jellyfin language via `document.documentElement.lang` (set by Jellyfin Web according to user preferences) with a fallback to `navigator.language`. French and English are fully supported. All user-facing strings â€” admin page labels, toasts, validation errors, confirm dialog, toolbar tooltips, user popup, history accordion â€” are translated. Adding a new language requires only a new dictionary entry in `ip-i18n.js`.\\- **`ip-i18n.js` module** â€” language detection (`detectLang()`) + `window.__IP.t(key, ...args)` translation function with `{0}`, `{1}` placeholder substitution.\\\\### Changed\\\\- **`client.js` split into 5 focused modules** â€” the 1 217-line monolith is replaced by a lightweight loader (`client.js`, ~50 lines) that injects modules sequentially via dynamic `<script>` tags:\\  - `ip-i18n.js` â€” language detection + FR/EN dictionaries\\  - `ip-utils.js` â€” shared utilities (`apiFetch`, `escHtml`, `renderBody`, `formatDate`)\\  - `ip-styles.js` â€” idempotent CSS injection (`injectStyles`)\\  - `ip-admin.js` â€” admin configuration page (form, table, toolbar, targeting, CRUD)\\  - `ip-popup.js` â€” user popup + MutationObserver (auto-starts)\\- **`window.__IP` namespace** â€” all inter-module functions are exposed via `window.__IP` instead of closed-over variables. Each module is an IIFE that reads and extends `window.__IP`.\\- **Controller â€” generic JS module endpoint** â€” `GET /InfoPopup/client.js` is replaced by `GET /InfoPopup/{module}.js` with a whitelist (`client.js`, `ip-*.js`). The old dedicated action is removed; a single action now serves all modules.\\- **`configurationpage.html`** â€” static text remains in French as default (overridden by `applyStaticTranslations()` at runtime). Added `id` attributes to all translatable elements (`#ip-subtitle`, `#ip-title-label`, `#ip-body-label`, `#ip-recipients-label`, `#ip-history-title`, `#ip-select-all-label`, `#ip-delete-btn-label`). The `<span>` inside `#ip-delete-btn` is now a separate element to allow text-only translation without touching the icon.\\- **`Jellyfin.Plugin.InfoPopup.csproj`** â€” `ip-i18n.js`, `ip-utils.js`, `ip-styles.js`, `ip-admin.js`, `ip-popup.js` added as `<EmbeddedResource>`.\\- **`CLAUDE.md`** â€” architecture, naming, pitfalls and REST API reference updated for v0.6.\\\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.6.2.0/infopopup_0.6.2.0.zip",
        "checksum": "cdb054c8aee87d1cfc22e8df58af033f",
        "timestamp": "2026-02-23T16:36:16Z"
      },
      {
        "version": "0.5.0.0",
        "changelog": "\\### SÃ©curitÃ©\\\\- **ContrÃ´le d'accÃ¨s sur `GET /messages` et `GET /messages/{id}`** â€” ces endpoints Ã©taient accessibles Ã  tout utilisateur authentifiÃ©, exposant la liste complÃ¨te des messages y compris leurs `TargetUserIds` et leurs corps, indÃ©pendamment du ciblage. DÃ©sormais : les admins voient tout ; les utilisateurs ne voient que les messages qui leur sont destinÃ©s. `GET /messages/{id}` retourne `404` (et non `403`) si l'utilisateur n'est pas ciblÃ©, pour ne pas rÃ©vÃ©ler l'existence d'un message non destinÃ©.\\- **UserId vide â†’ 401 explicite** â€” quand le claim `Jellyfin-UserId` est absent du token, le code retournait silencieusement un ID vide qui crÃ©ait un enregistrement fantÃ´me dans `infopopup_seen.json`. Tous les endpoints utilisateur retournent maintenant `401 Unauthorized` explicitement si l'ID est absent.\\\\### AjoutÃ©\\\\- **Endpoint `GET /InfoPopup/popup-data`** â€” retourne en un seul appel tout ce dont la popup a besoin : messages non vus avec corps complet + historique en rÃ©sumÃ©s. Remplace l'ancien pattern N+1 qui gÃ©nÃ©rait jusqu'Ã  `2 + N + M` requÃªtes HTTP pour afficher une popup.\\- **Endpoint `POST /InfoPopup/messages/delete`** (admin) â€” remplace `DELETE /messages` avec body. Certains proxies et pare-feux rejettent silencieusement les requÃªtes `DELETE` avec un body. L'ancien endpoint `DELETE` est supprimÃ©.\\- **Dossier `DTOs/`** â€” `MessageDtos.cs` regroupe tous les DTOs (`CreateMessageRequest`, `DeleteMessagesRequest`, `UpdateMessageRequest`, `MarkSeenRequest`, `MessageSummary`, `MessageDetail`, `PopupDataResponse`). Ils Ã©taient prÃ©cÃ©demment dÃ©finis en tÃªte du fichier controller.\\\\### CorrigÃ©\\\\- **Race condition popup/marquage** â€” `popupActive` Ã©tait remis Ã  `false` immÃ©diatement Ã  la fermeture de la popup, avant que le `POST /seen` ait Ã©tÃ© confirmÃ© par le serveur. `popupActive` reste maintenant Ã  `true` jusqu'au `.finally()` de `markAllSeen()`.\\- **Guard `popupActive` dans `schedulePopupCheck`** â€” sans ce guard, une navigation rapide aprÃ¨s fermeture pouvait re-dÃ©clencher un check rÃ©seau pendant que le marquage Ã©tait encore en transit.\\- **RÃ©fÃ©rence config capturÃ©e dans le lock** (`MessageStore`) â€” `Plugin.Instance?.Configuration` Ã©tait accÃ©dÃ© via une propriÃ©tÃ© sans assignation locale dans le bloc locktÃ©. La rÃ©fÃ©rence est maintenant capturÃ©e avec `var cfg = GetConfig()` Ã  l'intÃ©rieur de chaque bloc.\\- **Cache mÃ©moire dans `SeenTrackerService`** â€” `ReadStore()` lisait le fichier JSON depuis le disque Ã  chaque appel, y compris sous `ReadLock`. Un cache `_cache` est maintenant maintenu en mÃ©moire et invalidÃ© uniquement Ã  l'Ã©criture.\\- **AccessibilitÃ© du toast admin** â€” `aria-live=\"polite\"` et `role=\"status\"` ajoutÃ©s sur le toast lors de l'init de la page config et Ã  chaque affichage.\\\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.5.0.0/infopopup_0.5.0.0.zip",
        "checksum": "d51cd6f62b561d183081a972cfd1cc7f",
        "timestamp": "2026-02-23T13:11:19Z"
      },
      {
        "version": "0.4.0.0",
        "changelog": "\\### AjoutÃ©\\\\- **Formatage du corps des messages** â€” syntaxe lÃ©gÃ¨re rendue cÃ´tÃ© client en HTML sÃ©curisÃ© (escHtml() toujours appliquÃ© avant tout remplacement, XSS impossible) :\\  - `**texte**` â†’ gras\\  - `_texte_` â†’ italique\\  - `__texte__` â†’ soulignÃ©\\  - `~~texte~~` â†’ barrÃ©\\  - Lignes prÃ©fixÃ©es `- ` â†’ liste Ã  puces avec indentation (`<ul><li>`)\\  - Rendu actif dans la popup utilisateur, dans l'historique et dans le dÃ©roulant du tableau admin.\\- **Toolbar de formatage** au-dessus du textarea d'administration â€” cinq boutons (B, I, U, S, â€¢ Liste) qui wrappent la sÃ©lection courante. Chaque bouton est un toggle : appuyer une seconde fois retire le formatage.\\- **Modification de messages existants** â€” bouton Â« âœ Modifier Â» sur chaque ligne du tableau admin. Charge le message dans le formulaire, passe en mode Ã©dition (titre de section + libellÃ© du bouton changent, bouton Â« Annuler Â» apparaÃ®t). Utilise `PUT /InfoPopup/messages/{id}` : l'ID est conservÃ©, le suivi des vues n'est pas affectÃ© â€” un utilisateur ayant dÃ©jÃ  vu le message ne le reverra pas.\\- **Endpoint `PUT /InfoPopup/messages/{id}`** (admin uniquement) â€” met Ã  jour titre et corps sans toucher Ã  l'ID ni Ã  `infopopup_seen.json`.\\\\### CorrigÃ©\\\\- **Corps vide dans l'historique de la popup** â€” les messages dÃ©jÃ  vus passÃ©s Ã  `buildHistoryBlock` Ã©taient des `MessageSummary` sans `body`. `checkForUnseenMessages` prÃ©-charge dÃ©sormais le dÃ©tail complet de chaque message vu (via `Promise.all` en parallÃ¨le) avant d'ouvrir la popup.\\- **Mise en forme cassÃ©e du tableau admin** â€” CSS de `.ip-row-expand`, `.ip-row-chev`, `.ip-edit-btn` absent lors d'une navigation directe vers la page config (car `injectStyles()` n'Ã©tait appelÃ© que par `showPopup`). `initConfigPage()` appelle maintenant `injectStyles()` en premier.\\\\### ModifiÃ©\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.4.0.0/infopopup_0.4.0.0.zip",
        "checksum": "6bcbc8222286dbe162b3b994adb6e91d",
        "timestamp": "2026-02-23T10:19:23Z"
      },
      {
        "version": "0.3.0.0",
        "changelog": "\\### AjoutÃ©\\\\- **Affichage de tous les messages non vus en zone principale** â€” si un utilisateur a plusieurs messages non lus au moment de la connexion, chacun s'affiche dÃ©sormais dans sa propre carte titrÃ©e (avec titre en gras + corps), sans Ãªtre relÃ©guÃ© dans l'historique dÃ©roulant. L'historique ne contient plus que les messages dÃ©jÃ  vus.\\- **Titre du message affichÃ© dans l'en-tÃªte de la popup** â€” lorsqu'un seul message est non vu, son titre apparaÃ®t directement dans la barre d'en-tÃªte de la popup (Ã  cÃ´tÃ© de l'icÃ´ne ğŸ””). Lorsque plusieurs messages sont non vus, l'en-tÃªte affiche Â« N nouveaux messages Â».\\- **DÃ©roulant par ligne dans le tableau d'administration** â€” la colonne Titre de chaque message dans la page de config est dÃ©sormais cliquable : un clic insÃ¨re une ligne d'expansion en dessous affichant le corps du message, chargÃ© Ã  la demande (lazy-load). Un chevron animÃ© (â–¶ â†’ â†“) indique l'Ã©tat ouvert/fermÃ©.\\\\### ModifiÃ©\\\\- `checkForUnseenMessages` rÃ©cupÃ¨re maintenant le corps complet de tous les messages non vus en parallÃ¨le (`Promise.all`) avant d'ouvrir la popup, au lieu de ne charger que le plus rÃ©cent.\\- `showPopup` accepte dÃ©sormais deux arguments (`unseenMessages`, `seenMessages`) au lieu de trois, et adapte son rendu dynamiquement selon le nombre de messages non vus.\\- `renderMessages` gÃ©nÃ¨re une ligne d'expansion `<tr>` pour chaque message du tableau admin, avec chargement lazy du corps via l'API.\\\\---\\\\## [0.2.1.0] â€” 2026-02-20\\\\*(version initiale publiÃ©e)*\\\\### AjoutÃ©\\",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.3.0.0/infopopup_0.3.0.0.zip",
        "checksum": "482cf8d10ca73ca4ebe1e3b0f5228f52",
        "timestamp": "2026-02-23T09:52:46Z"
      },
      {
        "version": "0.2.1.0",
        "changelog": "Release v0.2.1.0",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.2.1.0/infopopup_0.2.1.0.zip",
        "checksum": "ebf0f52f77c603f22ac26fdbccc3a62a",
        "timestamp": "2026-02-22T17:40:58Z"
      },
      {
        "version": "0.2.0.0",
        "changelog": "Release v0.2.0.0",
        "targetAbi": "10.10.0.0",
        "sourceUrl": "https://github.com/crocodile13/jellyfin-info-popup-extention/releases/download/v0.2.0.0/infopopup_0.2.0.0.zip",
        "checksum": "8a5d02748a4ee36d1583a9ed093db2f0",
        "timestamp": "2026-02-21T18:08:04Z"
      }
    ]
  }
]
